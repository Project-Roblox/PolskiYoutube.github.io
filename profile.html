<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Tw贸j Profil - Statystyki PL YT</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; }
        header { height: 56px; padding: 0 20px; display: flex; align-items: center; background: #0f0f0f; border-bottom: 1px solid #333; }
        
        /* Statystyki na g贸rze */
        .profile-banner { background: #181818; padding: 40px 20px; text-align: center; border-bottom: 1px solid #333; }
        .stats-container { display: flex; justify-content: center; gap: 30px; margin-top: 20px; }
        .stat-item { background: #282828; padding: 15px 25px; border-radius: 12px; min-width: 100px; }
        .stat-value { display: block; font-size: 24px; font-weight: bold; color: #3ea6ff; }
        .stat-label { font-size: 12px; color: #aaa; text-transform: uppercase; }

        .avatar { width: 80px; height: 80px; background: #ff0000; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; }
        .container { padding: 20px; max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-top: 20px; }
        .v-card { background: #1a1a1a; border-radius: 12px; overflow: hidden; cursor: pointer; }
        .v-card video { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
    </style>
</head>
<body>

<header>
    <a href="index.html" style="color:white; text-decoration:none; font-weight:bold;"><span>PL</span> YouTube</a>
</header>

<div class="profile-banner">
    <div class="avatar" id="profLetter">?</div>
    <h2 id="profEmail">adowanie...</h2>
    
    <div class="stats-container">
        <div class="stat-item">
            <span class="stat-value" id="totalVideos">0</span>
            <span class="stat-label">Filmy</span>
        </div>
        <div class="stat-item">
            <span class="stat-value" id="totalLikes">0</span>
            <span class="stat-label">Lajki</span>
        </div>
        <div class="stat-item">
            <span class="stat-value" id="totalComments">0</span>
            <span class="stat-label">Komentarze</span>
        </div>
    </div>
</div>

<div class="container">
    <h3>Twoja tw贸rczo:</h3>
    <div class="grid" id="profGrid"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const userEmail = params.get('email');

    async function loadFullProfile() {
        if(!userEmail) return;

        document.getElementById('profEmail').innerText = userEmail;
        document.getElementById('profLetter').innerText = userEmail[0].toUpperCase();

        // 1. POBIERZ FILMY I POLICZ LAJKI
        const qVideos = query(collection(db, "content"), where("author", "==", userEmail));
        const videoSnap = await getDocs(qVideos);
        
        let totalLikes = 0;
        let videoIds = [];
        const grid = document.getElementById('profGrid');
        grid.innerHTML = "";

        videoSnap.forEach(doc => {
            const d = doc.data();
            videoIds.push(doc.id); // Zbieramy ID film贸w do liczenia komentarzy
            totalLikes += (d.likes || 0);

            // Dodaj kafelki
            const card = document.createElement('div');
            card.className = 'v-card';
            card.innerHTML = `
                <video src="${d.url}#t=0.5"></video>
                <div style="padding:10px;"><b>${d.title}</b><br><small> ${d.likes || 0}</small></div>
            `;
            card.onclick = () => location.href = `video.html?id=${doc.id}&url=${encodeURIComponent(d.url)}&title=${encodeURIComponent(d.title)}`;
            grid.appendChild(card);
        });

        // 2. POLICZ KOMENTARZE (Dla wszystkich Twoich film贸w)
        let totalComments = 0;
        if(videoIds.length > 0) {
            // Przeszukujemy kolekcj comments w poszukiwaniu Twoich film贸w
            const qComm = query(collection(db, "comments"), where("videoId", "in", videoIds));
            const commSnap = await getDocs(qComm);
            totalComments = commSnap.size;
        }

        // 3. WYWIETL STATYSTYKI
        document.getElementById('totalVideos').innerText = videoSnap.size;
        document.getElementById('totalLikes').innerText = totalLikes;
        document.getElementById('totalComments').innerText = totalComments;
    }

    loadFullProfile();
</script>
</body>
</html>
