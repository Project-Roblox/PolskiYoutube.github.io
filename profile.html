<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Profil</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; padding: 40px; }
        .container { max-width: 900px; margin: auto; }
        .upload { background: #1a1a1a; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #000; color: white; border: 1px solid #333; }
        .v-item { display: flex; justify-content: space-between; background: #111; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .badge { width: 20px; vertical-align: middle; }
    </style>
</head>
<body>
<div class="container">
    <button onclick="location.href='index.html'" style="color:gray; background:none; border:none; cursor:pointer;">&larr; Powrót</button>
    <h1>Profil: <span id="uName">...</span> <span id="vBadge"></span></h1>
    
    <div class="upload" id="uploadBox">
        <h3>Dodaj nowy film</h3>
        <input type="text" id="t" placeholder="Tytuł">
        <input type="text" id="u" placeholder="Link .mp4">
        <select id="type"><option value="video">Film</option><option value="short">Shorts</option></select>
        <button id="addBtn" style="width:100%; padding:10px; background:red; color:white; border:none; cursor:pointer;">OPUBLIKUJ</button>
    </div>

    <h3>Twoje filmy</h3>
    <div id="myList"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const V_IMG = "https://th.bing.com/th/id/R.503a526f8f8634741fb17f6c9d4d703e?rik=0GG6forTzHaljQ&pid=ImgRaw&r=0";

    onAuthStateChanged(auth, async user => {
        if(!user) return location.href='login.html';
        document.getElementById('uName').innerText = user.email;
        
        const uSnap = await getDoc(doc(db, "users", user.email));
        if(uSnap.exists() && uSnap.data().verified) {
            document.getElementById('vBadge').innerHTML = `<img src="${V_IMG}" class="badge">`;
        }
        loadMyVids(user.email);
    });

    window.loadMyVids = async (email) => {
        const q = query(collection(db, "content"), where("author", "==", email));
        const snap = await getDocs(q);
        const list = document.getElementById('myList');
        list.innerHTML = "";
        snap.forEach(d => {
            const v = d.data();
            list.innerHTML += `<div class="v-item"><span>${v.title}</span> <button onclick="del('${d.id}')" style="color:red; background:none; border:none; cursor:pointer;">USUŃ</button></div>`;
        });
    };

    document.getElementById('addBtn').onclick = async () => {
        const title = document.getElementById('t').value;
        const url = document.getElementById('u').value;
        const type = document.getElementById('type').value;
        await addDoc(collection(db, "content"), {
            title, url, type, author: auth.currentUser.email, createdAt: serverTimestamp()
        });
        alert("Dodano!"); location.reload();
    };

    window.del = async (id) => { if(confirm("Usunąć?")) { await deleteDoc(doc(db, "content", id)); location.reload(); } };
</script>
</body>
</html>
