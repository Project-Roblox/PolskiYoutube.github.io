<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>M贸j Profil</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        .upload-box { background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; margin-bottom: 30px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #121212; border: 1px solid #444; color: white; box-sizing: border-box; }
        .btn { padding: 10px 20px; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-blue { background: #3ea6ff; color: black; }
        .video-list { display: grid; gap: 10px; }
        .video-item { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <button onclick="location.href='index.html'" style="background:none; color:gray; border:none; cursor:pointer;">&larr; Wr贸 do serwisu</button>
    
    <h1>Panel Tw贸rcy</h1>
    <h3 id="userEmail">adowanie...</h3>

    <div class="upload-box">
        <h2> Dodaj Film</h2>
        <input type="text" id="vTitle" placeholder="Tytu filmu">
        <input type="text" id="vUrl" placeholder="Link bezporedni (.mp4)">
        <select id="vType">
            <option value="video">Zwyky Film (16:9)</option>
            <option value="short">Shorts (9:16)</option>
        </select>
        <button class="btn btn-blue" id="addBtn">OPUBLIKUJ</button>
    </div>

    <h2>Twoje Materiay</h2>
    <div id="myVideos" class="video-list"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853", measurementId: "G-B5M3F5J713" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
        if(!user) return location.href = "index.html";
        document.getElementById('userEmail').innerText = user.email + (user.emailVerified ? " (Zweryfikowany)" : " (Niezweryfikowany)");

        // 1. Dodawanie
        document.getElementById('addBtn').onclick = async () => {
            if(!user.emailVerified) return alert("Potwierd藕 e-mail, aby dodawa filmy!");
            const t = document.getElementById('vTitle').value;
            const u = document.getElementById('vUrl').value;
            const type = document.getElementById('vType').value;
            
            if(t && u) {
                await addDoc(collection(db, "content"), {
                    title: t, url: u, type: type, author: user.email, 
                    createdAt: serverTimestamp(), views: 0
                });
                alert("Dodano!");
                loadMyVideos(user.email); // Odwie偶 list
            }
        };

        // 2. adowanie listy
        loadMyVideos(user.email);
    });

    async function loadMyVideos(email) {
        const list = document.getElementById('myVideos');
        list.innerHTML = "adowanie...";
        const q = query(collection(db, "content"), where("author", "==", email));
        const snap = await getDocs(q);
        
        list.innerHTML = "";
        if(snap.empty) list.innerHTML = "Nie dodae jeszcze 偶adnych film贸w.";

        snap.forEach(d => {
            const data = d.data();
            const div = document.createElement('div');
            div.className = 'video-item';
            div.innerHTML = `
                <span><b>${data.title}</b> (${data.type})</span>
                <button onclick="deleteVideo('${d.id}')" style="background:#ff4444; color:white; border:none; padding:5px 10px; cursor:pointer; border-radius:4px;">USU</button>
            `;
            list.appendChild(div);
        });
    }

    // 3. Usuwanie
    window.deleteVideo = async (id) => {
        if(confirm("Na pewno usun ten film?")) {
            await deleteDoc(doc(db, "content", id));
            location.reload();
        }
    };
</script>
</body>
</html>
