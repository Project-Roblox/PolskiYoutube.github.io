<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Administratora - PL YT</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; padding: 20px; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .admin-section { background: #1a1a1a; padding: 20px; border-radius: 12px; margin-top: 20px; }
        .item-card { 
            background: #282828; padding: 15px; border-radius: 8px; 
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; 
        }
        .btn { border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-verify { background: #3ea6ff; color: black; }
        .btn-delete { background: #ff4d4d; color: white; }
        #adminStatus { color: #3ea6ff; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>

    <h1>üõ†Ô∏è Panel Administratora</h1>
    <div id="adminStatus">Sprawdzanie uprawnie≈Ñ...</div>

    <div class="admin-section">
        <h3>Lista U≈ºytkownik√≥w (Weryfikacja)</h3>
        <div id="userList">≈Åadowanie u≈ºytkownik√≥w...</div>
    </div>

    <div class="admin-section">
        <h3>ZarzƒÖdzaj Filmami</h3>
        <div id="videoList">≈Åadowanie film√≥w...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, setDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
            authDomain: "polski-youtub2.firebaseapp.com",
            projectId: "polski-youtub2",
            storageBucket: "polski-youtub2.firebasestorage.app",
            messagingSenderId: "325129789226",
            appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
            measurementId: "G-B5M3F5J713"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // TWOJE ZABEZPIECZENIE
        const MY_ADMIN_EMAIL = "mikih9a@gmail.com"; 

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === MY_ADMIN_EMAIL) {
                document.getElementById('adminStatus').innerText = "Witaj, Panie Administratorze (" + user.email + ")";
                loadAdminData();
            } else {
                alert("Brak dostƒôpu! Sekcja tylko dla Admina.");
                window.location.href = "index.html";
            }
        });

        async function loadAdminData() {
            const vList = document.getElementById('videoList');
            const uList = document.getElementById('userList');

            // 1. ≈ÅADOWANIE FILM√ìW
            const vSnap = await getDocs(query(collection(db, "content"), orderBy("createdAt", "desc")));
            vList.innerHTML = "";
            vSnap.forEach(d => {
                const vid = d.data();
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <span><b>${vid.title}</b> (Autor: ${vid.author})</span>
                    <button class="btn btn-delete" id="del-${d.id}">USU≈É</button>
                `;
                vList.appendChild(card);
                document.getElementById(`del-${d.id}`).onclick = () => deleteVideo(d.id);
            });

            // 2. ≈ÅADOWANIE LISTY UNIKALNYCH U≈ªYTKOWNIK√ìW Z FILM√ìW
            const authors = new Set();
            vSnap.forEach(d => authors.add(d.data().author));
            uList.innerHTML = "";
            authors.forEach(email => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.innerHTML = `
                    <span>${email}</span>
                    <button class="btn btn-verify" id="ver-${email.replace(/[@.]/g, '')}">NADAJ ZNACZEK ‚úîÔ∏è</button>
                `;
                uList.appendChild(card);
                document.getElementById(`ver-${email.replace(/[@.]/g, '')}`).onclick = () => verifyUser(email);
            });
        }

        // FUNKCJA USUWANIA
        async function deleteVideo(id) {
            if(confirm("Czy na pewno usunƒÖƒá ten film?")) {
                await deleteDoc(doc(db, "content", id));
                location.reload();
            }
        }

        // FUNKCJA WERYFIKACJI
        async function verifyUser(email) {
            await setDoc(doc(db, "users", email), {
                verified: true,
                email: email
            }, { merge: true });
            alert("U≈ºytkownik " + email + " zosta≈Ç zweryfikowany!");
        }
    </script>
</body>
</html>
