<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Polski YT - Home</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; }
        header { padding: 10px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid #333; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; }
        .card { background: #1e1e1e; border-radius: 10px; cursor: pointer; overflow: hidden; }
        .card video { width: 100%; aspect-ratio: 16/9; background: #000; }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
        .m-box { background:#222; padding:30px; border-radius:10px; width:400px; }
        input { width:100%; padding:10px; margin:10px 0; background:#000; border:1px solid #444; color:white; }
        .btn { background: red; color:white; border:none; padding:10px 20px; cursor:pointer; font-weight:bold; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 24px; font-weight: bold; color: red;">PL YT</div>
    <button class="btn" onclick="document.getElementById('upModal').style.display='flex'">+ DODAJ FILM</button>
</header>

<div class="grid" id="mainGrid"></div>

<div id="upModal" class="modal">
    <div class="m-box">
        <h3>Dodaj Film (Wklej link)</h3>
        <input type="text" id="vTitle" placeholder="Tytuł filmu">
        <input type="text" id="vUrl" placeholder="Link do pliku .mp4 (np. z Discorda)">
        <button class="btn" onclick="uploadVideo()">OPUBLIKUJ</button>
        <button onclick="document.getElementById('upModal').style.display='none'" style="background:none; color:gray; border:none; cursor:pointer;">Zamknij</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function load() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = "";
        const q = query(collection(db, "videos"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        snap.forEach(doc => {
            const d = doc.data();
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<video src="${d.url}"></video><div style="padding:10px"><b>${d.title}</b></div>`;
            card.onclick = () => window.location.href = `video.html?id=${doc.id}&url=${encodeURIComponent(d.url)}&title=${encodeURIComponent(d.title)}`;
            grid.appendChild(card);
        });
    }

    window.uploadVideo = async () => {
        const title = document.getElementById('vTitle').value;
        const url = document.getElementById('vUrl').value;
        if(!title || !url) return alert("Uzupełnij pola!");

        await addDoc(collection(db, "videos"), {
            title: title,
            url: url,
            createdAt: new Date()
        });
        location.reload();
    }
    load();
</script>
</body>
</html>
