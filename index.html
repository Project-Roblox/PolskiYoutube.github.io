<header>
    <div class="logo" onclick="location.reload()"><span>PL</span> YouTube</div>
    
    <div id="auth-area">
        <button id="loginBtn" class="btn" onclick="openAuthModal()">ZALOGUJ SIĘ</button>
        
        <div id="userPanel" style="display:none; align-items: center; gap: 15px;">
            <span id="userEmail" style="font-size: 14px; color: #aaa;"></span>
            <button class="btn-add" onclick="toggleModal(true)">+ DODAJ FILM</button>
            <button id="logoutBtn" class="btn" style="background:#333;" onclick="handleLogout()">WYLOGUJ</button>
        </div>
    </div>
</header>
</header>

<div id="authModal" class="modal">
    <div class="modal-content">
        <h2 id="authTitle">Logowanie</h2>
        <input type="email" id="email" placeholder="E-mail">
        <input type="password" id="password" placeholder="Hasło">
        <button class="publish-btn" id="submitAuth">Zatwierdź</button>
        <p id="toggleAuth" style="cursor:pointer; font-size:12px; margin-top:10px; color:#3ea6ff;">Nie masz konta? Zarejestruj się</p>
        <button onclick="document.getElementById('authModal').style.display='none'" style="border:none; background:none; color:gray; cursor:pointer;">Anuluj</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    // ... reszta importów (firestore)

    const firebaseConfig = { /* TWÓJ CONFIG */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const authModal = document.getElementById('authModal');
    let isRegisterMode = false;

    // Przełączanie Rejestracja / Logowanie
    document.getElementById('toggleAuth').onclick = () => {
        isRegisterMode = !isRegisterMode;
        document.getElementById('authTitle').innerText = isRegisterMode ? "Rejestracja" : "Logowanie";
        document.getElementById('toggleAuth').innerText = isRegisterMode ? "Masz już konto? Zaloguj się" : "Nie masz konta? Zarejestruj się";
    };

    // Obsługa przycisku w modalach
    document.getElementById('submitAuth').onclick = async () => {
        const mail = document.getElementById('email').value;
        const pass = document.getElementById('password').value;

        try {
            if (isRegisterMode) {
                await createUserWithEmailAndPassword(auth, mail, pass);
                alert("Konto utworzone!");
            } else {
                await signInWithEmailAndPassword(auth, mail, pass);
            }
            authModal.style.display = 'none';
        } catch (e) {
            alert("Błąd: " + e.message);
        }
    };

    // MONITOROWANIE STANU LOGOWANIA
    onAuthStateChanged(auth, (user) => {
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const uploadBtn = document.getElementById('mainUploadBtn');

        if (user) {
            // Zalogowany
            loginBtn.style.display = 'none';
            logoutBtn.style.display = 'inline-block';
            uploadBtn.style.display = 'inline-block';
            console.log("Zalogowano jako:", user.email);
        } else {
            // Wylogowany
            loginBtn.style.display = 'inline-block';
            logoutBtn.style.display = 'none';
            uploadBtn.style.display = 'none';
        }
    });

    document.getElementById('loginBtn').onclick = () => authModal.style.display = 'flex';
    document.getElementById('logoutBtn').onclick = () => signOut(auth);
</script>
