<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>OglƒÖdasz</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; padding: 20px; margin: 0; }
        .video-box { max-width: 800px; margin: auto; }
        .short-mode video { width: 350px; aspect-ratio: 9/16; margin: auto; display: block; }
        video { width: 100%; border-radius: 12px; }
        .actions { display: flex; gap: 20px; margin: 15px 0; }
        .btn-like { background: #222; border: 1px solid #444; color: white; padding: 10px 20px; border-radius: 20px; cursor: pointer; }
        .comment-input { width: 100%; background: #000; border: none; border-bottom: 1px solid #333; color: white; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="video-box" id="vBox">
    <button onclick="history.back()" style="background:none; color:white; border:none; cursor:pointer;">‚¨Ö Powr√≥t</button>
    <video id="player" controls autoplay></video>
    <h1 id="vTitle">Tytu≈Ç</h1>
    
    <div class="actions">
        <button class="btn-like" id="likeBtn">üëç <span id="likeCount">0</span></button>
    </div>

    <hr color="#333">
    <h3>Komentarze</h3>
    <input type="text" id="cNick" placeholder="Tw√≥j Nick" style="width:30%; background:#111; color:white; border:none; padding:5px;">
    <input type="text" id="cText" class="comment-input" placeholder="Dodaj publiczny komentarz...">
    <button onclick="addComment()" style="background:#3ea6ff; border:none; padding:5px 15px; border-radius:5px; cursor:pointer;">Skomentuj</button>
    
    <div id="cList" style="margin-top:20px;"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, updateDoc, increment, collection, addDoc, query, where, orderBy, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const type = params.get('type');

    if(type === 'short') document.getElementById('vBox').className = 'short-mode';
    document.getElementById('player').src = params.get('url');
    document.getElementById('vTitle').innerText = params.get('title');

    // ≈ÅADOWANIE LAJK√ìW
    async function getLikes() {
        const d = await getDoc(doc(db, "content", id));
        if(d.exists()) document.getElementById('likeCount').innerText = d.data().likes || 0;
    }
    getLikes();

    // DODAWANIE LAJKA
    document.getElementById('likeBtn').onclick = async () => {
        await updateDoc(doc(db, "content", id), { likes: increment(1) });
        getLikes();
    };

    // KOMENTARZE
    window.addComment = async () => {
        const nick = document.getElementById('cNick').value || "Anonim";
        const text = document.getElementById('cText').value;
        if(!text) return;

        await addDoc(collection(db, "comments"), {
            videoId: id, nick: nick, text: text, createdAt: new Date()
        });
        document.getElementById('cText').value = "";
    };

    // WY≈öWIETLANIE KOMENTARZY (Na ≈ºywo)
    const q = query(collection(db, "comments"), where("videoId", "==", id), orderBy("createdAt", "desc"));
    onSnapshot(q, (snap) => {
        const list = document.getElementById('cList');
        list.innerHTML = "";
        snap.forEach(d => {
            const comm = d.data();
            const div = document.createElement('div');
            div.style = "margin-bottom:15px; border-left: 2px solid #333; padding-left:10px;";
            div.innerHTML = `<b>@${comm.nick}</b><br>${comm.text}`;
            list.appendChild(div);
        });
    });
</script>
</body>
</html>
