<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 240px; border-right: 1px solid #333; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        header { padding: 15px; display: flex; justify-content: center; border-bottom: 1px solid #333; }
        .search { width: 50%; background: #121212; border: 1px solid #333; padding: 10px; border-radius: 20px; color: white; outline: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; }
        .v-card { cursor: pointer; }
        .v-card video { width: 100%; border-radius: 12px; aspect-ratio: 16/9; object-fit: cover; }
        .badge { width: 14px; vertical-align: middle; margin-left: 3px; }
        .menu-btn { padding: 10px; text-decoration: none; color: #aaa; border-radius: 8px; }
        .menu-btn:hover { background: #222; color: white; }
    </style>
</head>
<body>
<div class="sidebar">
    <h2 style="color:red">PL YouTube</h2>
    <a href="index.html" class="menu-btn">ğŸ  GÅ‚Ã³wna</a>
    <a href="shorts.html" class="menu-btn">ğŸ“± Shorts</a>
    <a href="history.html" class="menu-btn">ğŸ“œ Historia</a>
    <a href="profile.html" class="menu-btn">ğŸ‘¤ MÃ³j Profil</a>
    <button id="logoutBtn" style="background:none; border:none; color:gray; cursor:pointer; text-align:left; padding:10px;">ğŸšª Wyloguj</button>
</div>
<div class="main">
    <header><input type="text" id="searchInput" class="search" placeholder="Szukaj filmÃ³w..."></header>
    <div id="videoGrid" class="grid"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const V_IMG = "https://th.bing.com/th/id/R.503a526f8f8634741fb17f6c9d4d703e?rik=0GG6forTzHaljQ&pid=ImgRaw&r=0";

    onAuthStateChanged(auth, user => { if(!user) location.href='login.html'; });
    document.getElementById('logoutBtn').onclick = () => signOut(auth);

    async function load() {
        const snap = await getDocs(query(collection(db, "content"), orderBy("createdAt", "desc")));
        const grid = document.getElementById('videoGrid');
        grid.innerHTML = "";
        
        for(const d of snap.docs) {
            const v = d.data();
            const uSnap = await getDoc(doc(db, "users", v.author));
            const isV = uSnap.exists() && uSnap.data().verified;

            const div = document.createElement('div');
            div.className = 'v-card';
            div.onclick = () => location.href=`video.html?id=${d.id}`;
            div.innerHTML = `
                <video src="${v.url}#t=0.1" muted></video>
                <div style="padding:10px">
                    <b>${v.title}</b><br>
                    <small style="color:gray">${v.author} ${isV ? `<img src="${V_IMG}" class="badge">`:''}</small>
                </div>
            `;
            grid.appendChild(div);
        }
    }
    load();
</script>
</body>
</html>
