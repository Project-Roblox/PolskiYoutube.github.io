<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polski YouTube 2.0</title>
    <style>
        :root { --yt-red: #ff0000; --yt-main: #0f0f0f; --yt-paper: #1a1a1a; --yt-blue: #3ea6ff; }
        body { background: var(--yt-main); color: white; font-family: 'Roboto', Arial, sans-serif; margin: 0; overflow-x: hidden; }
        
        /* HEADER */
        header { 
            height: 56px; padding: 0 20px; display: flex; align-items: center; 
            justify-content: space-between; background: var(--yt-main); 
            border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-size: 20px; font-weight: bold; cursor: pointer; text-decoration: none; color: white; display: flex; align-items: center; }
        .logo span { background: var(--yt-red); padding: 2px 8px; border-radius: 4px; margin-right: 5px; }
        
        /* PRZYCISKI */
        .btn { border: none; padding: 8px 16px; border-radius: 18px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.2s; }
        .btn-blue { background: var(--yt-blue); color: #0f0f0f; }
        .btn-gray { background: #272727; color: white; }
        .btn-gray:hover { background: #3f3f3f; }
        .user-tools { display: flex; align-items: center; gap: 10px; }

        /* KONTENER I SIATKA */
        .container { max-width: 1400px; margin: auto; padding: 20px; }
        h3 { margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        
        .video-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; margin-bottom: 40px; 
        }
        .v-card { cursor: pointer; transition: 0.2s; border-radius: 12px; overflow: hidden; }
        .v-card:hover { background: #272727; transform: translateY(-3px); }
        .thumb { width: 100%; aspect-ratio: 16/9; background: #000; object-fit: cover; border-radius: 12px; }
        .v-info { padding: 12px 5px; }
        .v-title { font-weight: bold; display: block; margin-bottom: 4px; }
        .v-author { color: #aaa; font-size: 13px; }

        /* SHORTSY */
        .shorts-row { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: thin; }
        .short-card { width: 180px; flex-shrink: 0; aspect-ratio: 9/16; cursor: pointer; position: relative; }
        .short-card video { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; background: #222; }

        /* MODALE */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; 
        }
        .modal-content { background: #282828; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; }
        input, select { 
            width: 100%; padding: 12px; margin: 10px 0; background: #121212; 
            border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; 
        }
    </style>
</head>
<body>

<header>
    <div class="logo" id="mainLogo"><span>PL</span> YouTube</div>
    <div id="authArea">
        <button id="showLoginBtn" class="btn btn-blue">ZALOGUJ SIÄ˜</button>
        
        <div id="userMenu" style="display:none;" class="user-tools">
            <button id="myProfileBtn" class="btn btn-blue">MÃ“J PROFIL</button>
            <button id="showUploadBtn" class="btn btn-gray">+ DODAJ</button>
            <button id="logoutBtn" class="btn btn-gray">WYLOGUJ</button>
        </div>
    </div>
</header>

<div class="container">
    <h3>ðŸ“± Shortsy</h3>
    <div class="shorts-row" id="shortsList"></div>
    
    <hr style="border:0; border-top:1px solid #333; margin: 30px 0;">
    
    <h3>ðŸŽ¥ Filmy</h3>
    <div class="video-grid" id="videoList"></div>
</div>

<div id="authModal" class="modal">
    <div class="modal-content">
        <h2 id="authTitle">Logowanie</h2>
        <input type="email" id="emailInp" placeholder="E-mail">
        <input type="password" id="passInp" placeholder="HasÅ‚o">
        <button class="btn btn-blue" style="width:100%; margin-top:10px;" id="submitAuth">DALEJ</button>
        <p id="switchAuth" style="color:var(--yt-blue); cursor:pointer; font-size:13px; text-align:center; margin-top:15px;">Nie masz konta? Zarejestruj siÄ™</p>
        <button id="closeAuth" style="background:none; color:gray; border:none; width:100%; margin-top:10px; cursor:pointer;">Anuluj</button>
    </div>
</div>

<div id="uploadModal" class="modal">
    <div class="modal-content">
        <h2>Opublikuj film</h2>
        <input type="text" id="vTitle" placeholder="TytuÅ‚ filmu">
        <input type="text" id="vUrl" placeholder="Link do pliku .mp4">
        <select id="vType">
            <option value="video">ZwykÅ‚y Film (16:9)</option>
            <option value="short">Short (9:16)</option>
        </select>
        <button class="btn btn-blue" style="width:100%; margin-top:10px;" id="submitVideo">OPUBLIKUJ</button>
        <button id="closeUpload" style="background:none; color:gray; border:none; width:100%; margin-top:10px; cursor:pointer;">Anuluj</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- OBSÅUGA INTERFEJSU (MODALE) ---
    const authModal = document.getElementById('authModal');
    const uploadModal = document.getElementById('uploadModal');
    let isRegisterMode = false;

    document.getElementById('showLoginBtn').onclick = () => authModal.style.display = 'flex';
    document.getElementById('closeAuth').onclick = () => authModal.style.display = 'none';
    document.getElementById('showUploadBtn').onclick = () => uploadModal.style.display = 'flex';
    document.getElementById('closeUpload').onclick = () => uploadModal.style.display = 'none';
    document.getElementById('mainLogo').onclick = () => location.reload();

    document.getElementById('switchAuth').onclick = () => {
        isRegisterMode = !isRegisterMode;
        document.getElementById('authTitle').innerText = isRegisterMode ? "Rejestracja" : "Logowanie";
        document.getElementById('switchAuth').innerText = isRegisterMode ? "Masz konto? Zaloguj siÄ™" : "Nie masz konta? Zarejestruj siÄ™";
    };

    // --- AUTORYZACJA ---
    document.getElementById('submitAuth').onclick = async () => {
        const email = document.getElementById('emailInp').value;
        const pass = document.getElementById('passInp').value;
        try {
            if(isRegisterMode) {
                await createUserWithEmailAndPassword(auth, email, pass);
            } else {
                await signInWithEmailAndPassword(auth, email, pass);
            }
            authModal.style.display = 'none';
        } catch(e) { 
            if(e.code === 'auth/email-already-in-use') alert("To konto juÅ¼ istnieje!");
            else alert("BÅ‚Ä…d: " + e.message); 
        }
    };

    document.getElementById('logoutBtn').onclick = () => signOut(auth);

    onAuthStateChanged(auth, (user) => {
        const userMenu = document.getElementById('userMenu');
        const loginBtn = document.getElementById('showLoginBtn');
        if (user) {
            userMenu.style.display = 'flex';
            loginBtn.style.display = 'none';
            // Przycisk MÃ³j Profil
            document.getElementById('myProfileBtn').onclick = () => {
                location.href = `profile.html?email=${encodeURIComponent(user.email)}`;
            };
        } else {
            userMenu.style.display = 'none';
            loginBtn.style.display = 'block';
        }
    });

    // --- PUBLIKOWANIE ---
    document.getElementById('submitVideo').onclick = async () => {
        const title = document.getElementById('vTitle').value;
        const url = document.getElementById('vUrl').value;
        const type = document.getElementById('vType').value;

        if(!title || !url) return alert("WypeÅ‚nij wszystkie pola!");

        await addDoc(collection(db, "content"), {
            title: title,
            url: url,
            type: type,
            author: auth.currentUser.email,
            createdAt: new Date(),
            likes: 0,
            views: 0
        });
        location.reload();
    };

    // --- ÅADOWANIE TREÅšCI ---
    async function loadMainPage() {
        const videoGrid = document.getElementById('videoList');
        const shortsRow = document.getElementById('shortsList');
        
        const q = query(collection(db, "content"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        
        videoGrid.innerHTML = "";
        shortsRow.innerHTML = "";

        snap.forEach(doc => {
            const data = doc.data();
            const id = doc.id;

            if(data.type === 'short') {
                const sCard = document.createElement('div');
                sCard.className = 'short-card';
                sCard.innerHTML = `<video src="${data.url}#t=0.1"></video>`;
                sCard.onclick = () => location.href = `video.html?id=${id}&url=${encodeURIComponent(data.url)}&title=${encodeURIComponent(data.title)}&type=short`;
                shortsRow.appendChild(sCard);
            } else {
                const vCard = document.createElement('div');
                vCard.className = 'v-card';
                vCard.innerHTML = `
                    <video class="thumb" src="${data.url}#t=0.1"></video>
                    <div class="v-info">
                        <span class="v-title">${data.title}</span>
                        <span class="v-author">${data.author}</span>
                    </div>
                `;
                vCard.onclick = () => location.href = `video.html?id=${id}&url=${encodeURIComponent(data.url)}&title=${encodeURIComponent(data.title)}`;
                videoGrid.appendChild(vCard);
            }
        });
    }

    // Sekretne wejÅ›cie do Admina (5 klikniÄ™Ä‡ w logo)
    let clicks = 0;
    document.getElementById('mainLogo').addEventListener('click', () => {
        clicks++;
        if(clicks === 5) location.href = "admin.html";
        setTimeout(() => clicks = 0, 3000);
    });

    loadMainPage();
</script>
</body>
</html>
