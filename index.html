<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 240px; border-right: 1px solid #333; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: #0f0f0f; }
        .main { flex: 1; overflow-y: auto; padding: 20px; }
        header { height: 60px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .search { background: #121212; border: 1px solid #333; padding: 8px 15px; border-radius: 20px; color: white; width: 400px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .shorts-row { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 20px; }
        .v-card { cursor: pointer; background: #1a1a1a; border-radius: 12px; overflow: hidden; }
        .v-card video { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .s-card { width: 180px; flex-shrink: 0; cursor: pointer; }
        .s-card video { width: 100%; aspect-ratio: 9/16; border-radius: 12px; object-fit: cover; }
        
        .badge { width: 14px; vertical-align: middle; margin-left: 3px; }
        .btn-auth { background: #3ea6ff; color: #0f0f0f; border: none; padding: 8px 16px; border-radius: 18px; cursor: pointer; font-weight: bold; }
        .nav-link { color: #aaa; text-decoration: none; padding: 10px; border-radius: 8px; }
        .nav-link:hover { background: #222; color: white; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color:red; margin-bottom:30px;"><span>PL</span> YouTube</h2>
    <a href="index.html" class="nav-link" style="color:white; background:#222;">üè† G≈Ç√≥wna</a>
    <a href="shorts.html" class="nav-link">üì± Shorts</a>
    <a href="history.html" class="nav-link">üìú Historia</a>
    <a href="profile.html" class="nav-link">üë§ M√≥j Profil</a>
    <div id="adminArea" style="display:none"><a href="admin.html" class="nav-link" style="color:red">‚öôÔ∏è Admin</a></div>
    <div id="authSidebar" style="margin-top:auto"></div>
</div>

<div class="main">
    <header>
        <input type="text" id="searchInput" class="search" placeholder="Szukaj...">
        <div id="topAuth"></div>
    </header>

    <h3>üì± Shortsy</h3>
    <div id="shortsGrid" class="shorts-row">≈Åadowanie...</div>
    
    <hr style="border:0; border-top:1px solid #333; margin:30px 0;">
    
    <h3>üé• Polecane Filmy</h3>
    <div id="videoGrid" class="grid">≈Åadowanie...</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const V_IMG = "https://th.bing.com/th/id/R.503a526f8f8634741fb17f6c9d4d703e?rik=0GG6forTzHaljQ&pid=ImgRaw&r=0";

    // Obs≈Çuga logowania/wylogowania bez pƒôtli przekierowa≈Ñ
    onAuthStateChanged(auth, user => {
        const top = document.getElementById('topAuth');
        const side = document.getElementById('authSidebar');
        if(user) {
            top.innerHTML = `<span style="margin-right:10px">${user.email}</span>`;
            side.innerHTML = `<button class="nav-link" id="outBtn" style="background:none; border:none; width:100%; text-align:left; cursor:pointer">üö™ Wyloguj</button>`;
            document.getElementById('outBtn').onclick = () => signOut(auth);
            if(user.email === 'mikih9a@gmail.com') document.getElementById('adminArea').style.display = 'block';
        } else {
            top.innerHTML = `<button class="btn-auth" onclick="location.href='login.html'">ZALOGUJ</button>`;
            side.innerHTML = `<p style="font-size:12px; color:gray">Zaloguj siƒô, aby komentowaƒá i dodawaƒá filmy.</p>`;
        }
    });

    async function load() {
        const snap = await getDocs(query(collection(db, "content"), orderBy("createdAt", "desc")));
        const vGrid = document.getElementById('videoGrid');
        const sGrid = document.getElementById('shortsGrid');
        vGrid.innerHTML = ""; sGrid.innerHTML = "";

        for(const d of snap.docs) {
            const v = d.data();
            const uSnap = await getDoc(doc(db, "users", v.author));
            const isV = uSnap.exists() && uSnap.data().verified;
            const badge = isV ? `<img src="${V_IMG}" class="badge">` : '';

            if(v.type === 'short') {
                const div = document.createElement('div');
                div.className = 's-card';
                div.onclick = () => location.href = `shorts.html#vid-${d.id}`;
                div.innerHTML = `<video src="${v.url}#t=0.1" muted></video><div style="font-size:12px; margin-top:5px"><b>${v.title}</b><br>${v.author}${badge}</div>`;
                sGrid.appendChild(div);
            } else {
                const div = document.createElement('div');
                div.className = 'v-card';
                div.onclick = () => location.href = `video.html?id=${d.id}`;
                div.innerHTML = `<video src="${v.url}#t=0.1" muted></video><div style="padding:10px"><b>${v.title}</b><br><small style="color:gray">${v.author}${badge}</small></div>`;
                vGrid.appendChild(div);
            }
        }
    }
    load();
</script>
</body>
</html>
