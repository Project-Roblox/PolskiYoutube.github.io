<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Polski YT - Serwer Społecznościowy</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; }
        header { padding: 15px 5%; display: flex; justify-content: space-between; background: #0f0f0f; border-bottom: 1px solid #333; sticky; top: 0; }
        .upload-form { background: #1e1e1e; padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 600px; border: 1px solid #444; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 20px; }
        .video-card { background: #181818; border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; }
        .video-card:hover { background: #282828; }
        video { width: 100%; aspect-ratio: 16/9; background: #000; pointer-events: none; }
        input { width: 90%; padding: 10px; margin: 10px 0; background: #000; border: 1px solid #444; color: white; border-radius: 5px; }
        .btn-red { background: #ff0000; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 24px; font-weight: bold;">PL <span style="background: red; padding: 2px 5px; border-radius: 5px;">YouTube</span></div>
    <div id="user-status">Zaloguj się, aby publikować</div>
</header>

<div class="upload-form">
    <h3>Opublikuj nowy film</h3>
    <p style="font-size: 12px; color: #aaa;">Wskazówka: Wrzuć plik na Discord lub Catbox.moe i wklej tu link .mp4</p>
    <input type="text" id="vTitle" placeholder="Tytuł Twojego filmu">
    <input type="text" id="vUrl" placeholder="Link do pliku (musi kończyć się na .mp4)">
    <button class="btn-red" id="publishBtn">OPUBLIKUJ DLA WSZYSTKICH</button>
</div>

<div class="grid" id="mainGrid">
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // TWOJE DANE Z FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // FUNKCJA: Pobieranie filmów z bazy (wywoływana przy odświeżeniu)
    async function fetchVideos() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = "Ładowanie filmów z serwera...";
        
        const q = query(collection(db, "movies"), orderBy("createdAt", "desc"));
        const snapshot = await getDocs(q);
        
        grid.innerHTML = "";
        snapshot.forEach((doc) => {
            const video = doc.data();
            const card = document.createElement('div');
            card.className = 'video-card';
            card.innerHTML = `
                <video src="${video.url}#t=0.5"></video>
                <div style="padding: 10px;">
                    <b style="display: block;">${video.title}</b>
                    <small style="color: #aaa;">Dodano: ${new Date(video.createdAt.seconds * 1000).toLocaleDateString()}</small>
                </div>
            `;
            // Kliknięcie otwiera stronę odtwarzacza
            card.onclick = () => {
                window.location.href = `video.html?id=${doc.id}&url=${encodeURIComponent(video.url)}&title=${encodeURIComponent(video.title)}`;
            };
            grid.appendChild(card);
        });
    }

    // FUNKCJA: Wysyłanie filmu do bazy
    document.getElementById('publishBtn').onclick = async () => {
        const title = document.getElementById('vTitle').value;
        const url = document.getElementById('vUrl').value;

        if(!title || !url.includes('.mp4')) {
            return alert("Podaj tytuł i poprawny link do pliku .mp4!");
        }

        try {
            await addDoc(collection(db, "movies"), {
                title: title,
                url: url,
                createdAt: new Date()
            });
            alert("Film został opublikowany!");
            document.getElementById('vTitle').value = "";
            document.getElementById('vUrl').value = "";
            fetchVideos(); // Odśwież listę bez przeładowania strony
        } catch (e) {
            alert("Błąd bazy danych: " + e.message);
        }
    };

    // Ładuj filmy przy każdym wejściu na stronę
    fetchVideos();
</script>
</body>
</html>
