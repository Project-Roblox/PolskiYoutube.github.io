<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Polski YT - Przeglądaj</title>
    <style>
        /* Stylistyka Ciemnego YouTube */
        body { background: #0f0f0f; color: white; font-family: 'Roboto', Arial, sans-serif; margin: 0; }
        
        /* Pasek nawigacji */
        header { 
            height: 56px; padding: 0 20px; display: flex; align-items: center; 
            justify-content: space-between; background: #0f0f0f; position: sticky; top: 0; z-index: 100;
        }
        .logo { font-size: 20px; font-weight: bold; cursor: pointer; display: flex; align-items: center; }
        .logo span { background: red; color: white; padding: 2px 6px; border-radius: 4px; margin-right: 5px; }
        
        /* Przyciski */
        .btn-add { background: #272727; color: white; border: none; padding: 8px 16px; border-radius: 18px; cursor: pointer; font-weight: 500; }
        .btn-add:hover { background: #3f3f3f; }

        /* Siatka filmów */
        .video-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 16px; padding: 24px; 
        }
        .video-card { cursor: pointer; border-radius: 12px; overflow: hidden; transition: 0.2s; }
        .video-card:hover { background: #272727; }
        .thumbnail { width: 100%; aspect-ratio: 16/9; background: #222; border-radius: 12px; object-fit: cover; }
        .video-info { padding: 12px 4px; }
        .video-title { font-weight: bold; margin-bottom: 4px; display: block; }
        
        /* Okno dodawania (Modal) */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; 
        }
        .modal-content { background: #282828; padding: 24px; border-radius: 12px; width: 100%; max-width: 450px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #121212; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; }
        .publish-btn { width: 100%; padding: 12px; background: #3ea6ff; color: #000; border: none; border-radius: 18px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="location.reload()"><span>PL</span> YouTube</div>
    <button class="btn-add" onclick="toggleModal(true)">+ Dodaj film</button>
</header>

<div class="video-grid" id="mainGrid">
    <p style="color: #aaa;">Ładowanie filmów...</p>
</div>

<div id="uploadModal" class="modal">
    <div class="modal-content">
        <h2 style="margin-top: 0;">Opublikuj wideo</h2>
        <label>Tytuł filmu:</label>
        <input type="text" id="vTitle" placeholder="Np. Mój pierwszy vlog">
        
        <label>Link do pliku .mp4 (z Discorda/Catbox):</label>
        <input type="text" id="vUrl" placeholder="https://...">
        
        <button class="publish-btn" id="publishBtn">Opublikuj teraz</button>
        <button onclick="toggleModal(false)" style="background:none; color:#aaa; border:none; width:100%; margin-top:10px; cursor:pointer;">Anuluj</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Otwieranie/Zamykanie okna dodawania
    window.toggleModal = (show) => {
        document.getElementById('uploadModal').style.display = show ? 'flex' : 'none';
    };

    // POBIERANIE FILMÓW (Tylko do oglądania)
    async function fetchVideos() {
        const grid = document.getElementById('mainGrid');
        const q = query(collection(db, "movies"), orderBy("createdAt", "desc"));
        const snapshot = await getDocs(q);
        
        grid.innerHTML = "";
        snapshot.forEach((doc) => {
            const video = doc.data();
            const card = document.createElement('div');
            card.className = 'video-card';
            card.innerHTML = `
                <video class="thumbnail" src="${video.url}#t=0.5"></video>
                <div class="video-info">
                    <span class="video-title">${video.title}</span>
                    <small style="color: #aaa;">Kliknij, aby obejrzeć</small>
                </div>
            `;
            card.onclick = () => {
                window.location.href = `video.html?id=${doc.id}&url=${encodeURIComponent(video.url)}&title=${encodeURIComponent(video.title)}`;
            };
            grid.appendChild(card);
        });
    }

    // PUBLIKOWANIE (Działa w tle)
    document.getElementById('publishBtn').onclick = async () => {
        const title = document.getElementById('vTitle').value;
        const url = document.getElementById('vUrl').value;

        if(!title || !url) return alert("Wypełnij pola!");

        await addDoc(collection(db, "movies"), {
            title: title,
            url: url,
            createdAt: new Date()
        });
        
        toggleModal(false); // Zamknij okno po dodaniu
        fetchVideos(); // Odśwież listę
    };

    fetchVideos();
</script>
</body>
</html>
