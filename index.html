<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Projekt Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 240px; background: #0f0f0f; display: flex; flex-direction: column; padding: 20px; border-right: 1px solid #333; flex-shrink: 0; }
        .logo { font-size: 20px; font-weight: bold; margin-bottom: 30px; cursor: pointer; display: flex; align-items: center; }
        .logo span { background: red; padding: 2px 8px; border-radius: 4px; margin-right: 5px; color: white; }
        .menu-item { padding: 12px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; gap: 10px; color: #aaa; transition: 0.2s; text-decoration: none; }
        .menu-item:hover { background: #272727; color: white; }
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 60px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #333; padding: 0 20px; gap: 20px; }
        .search-box { display: flex; background: #121212; border: 1px solid #333; border-radius: 20px; padding: 5px 15px; width: 50%; }
        .search-box input { background: transparent; border: none; color: white; outline: none; width: 100%; }
        .content-area { flex: 1; overflow-y: scroll; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { cursor: pointer; }
        .card video { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 12px; background: #000; }
        
        /* Styl weryfikacji */
        .verified-badge { width: 14px; height: 14px; margin-left: 5px; vertical-align: middle; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo"><span>PL</span> YouTube</div>
    <a href="index.html" class="menu-item" style="color:white; font-weight:bold;"> G≈Ç√≥wna</a>
    <a href="shorts.html" class="menu-item"> Shorts</a>
    <a href="history.html" class="menu-item"> eHistoria</a>
    <a href="profile.html" class="menu-item"> Profil</a>
    <div id="adminPanelLink" style="display:none"><a href="admin.html" class="menu-item" style="color:#ff4444">‚öôÔ∏è ADMIN PANEL</a></div>
    <button id="logoutBtn" class="menu-item" style="background:none; border:none; margin-top:auto;">üö™ Wyloguj</button>
</div>

<div class="main">
    <header>
        <div class="search-box"><input type="text" id="searchInput" placeholder="Szukaj..."></div>
        <div id="authInfo"></div>
    </header>
    <div class="content-area">
        <div id="videoGrid" class="grid">≈Åadowanie...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, orderBy, getDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853", measurementId: "G-B5M3F5J713" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Wylogowywanie
    document.getElementById('logoutBtn').onclick = () => signOut(auth).then(() => location.href='login.html');

    onAuthStateChanged(auth, user => {
        if(user) {
            document.getElementById('authInfo').innerHTML = `Witaj, ${user.email.split('@')[0]}`;
            if(user.email === 'mikih9a@gmail.com') document.getElementById('adminPanelLink').style.display = 'block';
        } else {
            location.href = 'login.html'; // Przekieruj je≈õli niezalogowany
        }
    });

    async function load() {
        const q = query(collection(db, "content"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        const grid = document.getElementById('videoGrid');
        grid.innerHTML = "";

        for (const d of snap.docs) {
            const data = d.data();
            // Sprawdzamy czy autor jest zweryfikowany
            const uSnap = await getDoc(doc(db, "users", data.author));
            const isVerified = uSnap.exists() && uSnap.data().verified;
            
            // LINK DO ZDJƒòCIA WERYFIKACJI
            const verifyImg = isVerified ? `<img src="https://th.bing.com/th/id/R.503a526f8f8634741fb17f6c9d4d703e?rik=0GG6forTzHaljQ&pid=ImgRaw&r=0" class="verified-badge">` : '';

            const div = document.createElement('div');
            div.className = 'card';
            div.onclick = () => location.href = data.type === 'short' ? 'shorts.html' : `video.html?id=${d.id}`;
            div.innerHTML = `
                <video src="${data.url}#t=0.1" preload="metadata" muted></video>
                <div style="padding:10px">
                    <b>${data.title}</b><br>
                    <small style="color:#aaa">${data.author} ${verifyImg}</small>
                </div>
            `;
            grid.appendChild(div);
        }
    }
    load();
</script>
</body>
</html>
