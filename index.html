<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR (Lewy Pasek) */
        .sidebar { width: 240px; background: #0f0f0f; display: flex; flex-direction: column; padding: 20px; border-right: 1px solid #333; flex-shrink: 0; }
        .logo { font-size: 20px; font-weight: bold; margin-bottom: 30px; cursor: pointer; display: flex; align-items: center; }
        .logo span { background: red; padding: 2px 8px; border-radius: 4px; margin-right: 5px; color: white; }
        .menu-item { padding: 12px; cursor: pointer; border-radius: 10px; display: flex; align-items: center; gap: 10px; color: #aaa; transition: 0.2s; text-decoration: none; }
        .menu-item:hover { background: #272727; color: white; }
        .menu-item.active { background: #272727; color: white; font-weight: bold; }
        
        /* GWNA TRE */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        /* HEADER (Wyszukiwarka) */
        header { height: 60px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #333; padding: 0 20px; gap: 20px; }
        .search-box { display: flex; background: #121212; border: 1px solid #333; border-radius: 20px; padding: 5px 15px; width: 50%; }
        .search-box input { background: transparent; border: none; color: white; outline: none; width: 100%; }
        .filters { display: flex; gap: 10px; padding: 10px 20px; border-bottom: 1px solid #333; overflow-x: auto; }
        .filter-chip { background: #222; border: 1px solid #444; padding: 5px 12px; border-radius: 16px; cursor: pointer; font-size: 13px; white-space: nowrap; }
        .filter-chip.active { background: white; color: black; }

        /* LISTA FILMW */
        .content-area { flex: 1; overflow-y: scroll; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { cursor: pointer; }
        .card video { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 12px; background: #000; }
        .card-info { padding-top: 10px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo"><span>PL</span> YouTube</div>
    <a href="index.html" class="menu-item active"> G贸wna</a>
    <a href="shorts.html" class="menu-item"> Shorts</a>
    <a href="#" class="menu-item"> Subskrypcje (Wkr贸tce)</a>
    <hr style="border:0; border-top:1px solid #333; width:100%; margin: 10px 0;">
    <a href="history.html" class="menu-item">Historia</a>
    <a id="profileLink" href="#" class="menu-item">M贸j Profil</a>
    <a href="#" class="menu-item"> Ustawienia</a>
</div>

<div class="main">
    <header>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Szukaj...">
            <button style="background:none; border:none; cursor:pointer;"></button>
        </div>
        <div id="authBtnArea"></div>
    </header>

    <div class="filters">
        <div class="filter-chip active" onclick="filter('all', this)">Wszystkie</div>
        <div class="filter-chip" onclick="filter('video', this)">Filmy</div>
        <div class="filter-chip" onclick="filter('short', this)">Shorts</div>
        <div class="filter-chip" onclick="filter('long', this)">Dugie (>20min)</div>
    </div>

    <div class="content-area">
        <div id="videoGrid" class="grid">adowanie...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853", measurementId: "G-B5M3F5J713" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let allContent = [];

    // Logowanie / Profil
    onAuthStateChanged(auth, user => {
        const btnArea = document.getElementById('authBtnArea');
        const profLink = document.getElementById('profileLink');
        if(user) {
            btnArea.innerHTML = `<img src="https://ui-avatars.com/api/?name=${user.email}&background=random" style="width:32px; border-radius:50%; cursor:pointer" onclick="location.href='profile.html'">`;
            profLink.href = "profile.html";
        } else {
            btnArea.innerHTML = `<button onclick="location.href='login.html'" style="padding:5px 15px; background:#3ea6ff; border:none; border-radius:18px; cursor:pointer;">ZALOGUJ</button>`;
            profLink.onclick = () => alert("Zaloguj si!");
        }
    });

    // Pobieranie i Filtrowanie
    async function load() {
        const q = query(collection(db, "content"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        snap.forEach(d => allContent.push({id: d.id, ...d.data()}));
        render(allContent);
    }

    window.filter = (type, el) => {
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        
        let filtered = allContent;
        if(type === 'video') filtered = allContent.filter(x => x.type === 'video');
        if(type === 'short') filtered = allContent.filter(x => x.type === 'short');
        // Do "long" potrzebna jest metadata, na razie prosty filtr typ贸w
        render(filtered);
    };

    function render(list) {
        const grid = document.getElementById('videoGrid');
        grid.innerHTML = "";
        const search = document.getElementById('searchInput').value.toLowerCase();

        list.forEach(item => {
            if(!item.title.toLowerCase().includes(search)) return;

            const div = document.createElement('div');
            div.className = 'card';
            div.onclick = () => location.href = `video.html?id=${item.id}`;
            div.innerHTML = `
                <video src="${item.url}#t=0.1" preload="metadata" muted onmouseover="this.play()" onmouseout="this.pause();this.currentTime=0;"></video>
                <div class="card-info">
                    <b>${item.title}</b><br>
                    <small style="color:#aaa">${item.author}</small>
                </div>
            `;
            grid.appendChild(div);
        });
    }

    document.getElementById('searchInput').oninput = () => render(allContent);
    load();
</script>
</body>
</html>
