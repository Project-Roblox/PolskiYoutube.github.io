<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Oglądasz - Polski YT</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        video { width: 100%; border-radius: 12px; background: black; }
        .comm-box { background: #1e1e1e; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .comment { border-bottom: 1px solid #333; padding: 10px 0; }
        input { background: #000; color: white; border: 1px solid #444; padding: 10px; width: 70%; }
        button { padding: 10px 20px; background: white; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <button onclick="window.location.href='index.html'">⬅ POWRÓT</button>
    <video id="player" controls autoplay></video>
    <h1 id="vTitle">Tytuł</h1>
    <hr>
    
    <div class="comm-box">
        <h3>Komentarze</h3>
        <input type="text" id="cInput" placeholder="Dodaj komentarz...">
        <button id="sendComm">WYŚLIJ</button>
        <div id="cList" style="margin-top: 20px;"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const vId = params.get('id');
    const vUrl = params.get('url');
    const vTitle = params.get('title');

    document.getElementById('player').src = vUrl;
    document.getElementById('vTitle').innerText = vTitle;

    // Wysyłanie komentarza
    document.getElementById('sendComm').onclick = async () => {
        const text = document.getElementById('cInput').value;
        if(!text) return;

        await addDoc(collection(db, "comments"), {
            videoId: vId,
            text: text,
            createdAt: new Date()
        });
        document.getElementById('cInput').value = "";
    };

    // Pobieranie komentarzy "na żywo"
    const q = query(collection(db, "comments"), where("videoId", "==", vId), orderBy("createdAt", "desc"));
    onSnapshot(q, (snap) => {
        const list = document.getElementById('cList');
        list.innerHTML = "";
        snap.forEach(doc => {
            const d = doc.data();
            const div = document.createElement('div');
            div.className = 'comment';
            div.innerHTML = `<b>Użytkownik:</b> ${d.text}`;
            list.appendChild(div);
        });
    });
</script>
</body>
</html>
