<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>OglƒÖdasz - Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; padding: 0; }
        .nav-back { padding: 15px; }
        .video-container { max-width: 900px; margin: auto; padding: 0 15px; }
        .short-mode { max-width: 400px; }
        video { width: 100%; border-radius: 12px; background: #000; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        .info { padding: 20px 0; }
        .actions { display: flex; gap: 15px; margin-bottom: 20px; }
        .btn-action { background: #272727; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .btn-action:hover { background: #3f3f3f; }
        hr { border: 0; border-top: 1px solid #333; margin: 20px 0; }
        
        /* Komentarze */
        .comment-box { margin-top: 20px; }
        .c-input { width: 100%; background: none; border: none; border-bottom: 1px solid #333; color: white; padding: 10px 0; font-size: 16px; outline: none; transition: 0.3s; }
        .c-input:focus { border-bottom: 2px solid #3ea6ff; }
        .c-btn { background: #3ea6ff; color: #000; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; float: right; font-weight: bold; }
        .c-list { margin-top: 60px; }
        .comment-item { margin-bottom: 20px; display: flex; gap: 12px; }
        .avatar { width: 35px; height: 35px; background: #555; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    </style>
</head>
<body>

<div class="nav-back">
    <button class="btn-action" onclick="history.back()">‚¨Ö Powr√≥t</button>
</div>

<div class="video-container" id="vWrapper">
    <video id="mainPlayer" controls autoplay></video>
    <div class="info">
        <h1 id="vTitle" style="margin: 10px 0;">Tytu≈Ç filmu</h1>
        <div class="actions">
            <button id="likeBtn" class="btn-action">üëç <span id="likeCount">0</span></button>
            <button class="btn-action">üîó Udostƒôpnij</button>
        </div>
        <hr>
        <div class="comment-box">
            <h3 id="commCount">Komentarze</h3>
            <input type="text" id="cText" class="c-input" placeholder="Dodaj komentarz...">
            <button id="cBtn" class="c-btn">Opublikuj</button>
        </div>
        <div class="c-list" id="cList"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM",
        authDomain: "polski-youtub2.firebaseapp.com",
        projectId: "polski-youtub2",
        storageBucket: "polski-youtub2.firebasestorage.app",
        messagingSenderId: "325129789226",
        appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853",
        measurementId: "G-B5M3F5J713"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const videoId = params.get('id');
    const type = params.get('type');

    // Ustawienie odtwarzacza
    if(type === 'short') document.getElementById('vWrapper').classList.add('short-mode');
    document.getElementById('mainPlayer').src = params.get('url');
    document.getElementById('vTitle').innerText = params.get('title');

    // 1. ≈ÅADOWANIE DANYCH FILMU (Lajki)
    async function syncVideoData() {
        const d = await getDoc(doc(db, "content", videoId));
        if(d.exists()) {
            document.getElementById('likeCount').innerText = d.data().likes || 0;
        }
    }
    syncVideoData();

    // 2. OBS≈ÅUGA LAJK√ìW
    document.getElementById('likeBtn').onclick = async () => {
        if(!auth.currentUser) return alert("Musisz siƒô zalogowaƒá, aby polubiƒá film!");
        
        await updateDoc(doc(db, "content", videoId), {
            likes: increment(1)
        });
        syncVideoData();
    };

    // 3. OBS≈ÅUGA KOMENTARZY (Wysy≈Çanie)
    document.getElementById('cBtn').onclick = async () => {
        const text = document.getElementById('cText').value;
        if(!auth.currentUser) return alert("Zaloguj siƒô, aby komentowaƒá!");
        if(!text) return;

        await addDoc(collection(db, "comments"), {
            videoId: videoId,
            author: auth.currentUser.email,
            text: text,
            createdAt: new Date()
        });
        document.getElementById('cText').value = "";
    };

    // 4. ≈ÅADOWANIE KOMENTARZY (Na ≈ºywo)
    const q = query(collection(db, "comments"), where("videoId", "==", videoId), orderBy("createdAt", "desc"));
    onSnapshot(q, (snap) => {
        const list = document.getElementById('cList');
        list.innerHTML = "";
        document.getElementById('commCount').innerText = `Komentarze (${snap.size})`;
        
        snap.forEach(d => {
            const c = d.data();
            const item = document.createElement('div');
            item.className = 'comment-item';
            item.innerHTML = `
                <div class="avatar">${c.author[0].toUpperCase()}</div>
                <div>
                    <div style="font-size:13px; color:#aaa; font-weight:bold;">${c.author}</div>
                    <div style="margin-top:4px;">${c.text}</div>
                </div>
            `;
            list.appendChild(item);
        });
    });
</script>
</body>
</html>
