<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>OglƒÖdaj - Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; }
        .player-container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        video { width: 100%; border-radius: 12px; background: black; }
        .stats { color: #aaa; font-size: 14px; margin: 10px 0; }
        .author-box { display: flex; align-items: center; gap: 15px; background: #1a1a1a; padding: 15px; border-radius: 12px; margin: 15px 0; }
        .btn { background: #272727; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
<div class="player-container">
    <video id="vPlayer" controls autoplay></video>
    <h1 id="vTitle" style="font-size:20px;"></h1>
    <div class="stats" id="vStats">0 wy≈õwietle≈Ñ ‚Ä¢ 0 udostƒôpnie≈Ñ</div>
    <div class="author-box">
        <div id="vAuthor"></div>
        <button class="btn" style="background:white; color:black; margin-left:auto;">SUBSKRYBUJ</button>
    </div>
    <div style="display:flex; gap:10px;">
        <button class="btn" id="likeBtn">üëç <span id="likeCount">0</span></button>
        <button class="btn" id="shareBtn">üöÄ UDOSTƒòPNIJ</button>
        <button onclick="location.href='index.html'" class="btn">WR√ìƒÜ</button>
    </div>
</div>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, arrayUnion, arrayRemove, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCpp-nUIT7bHmtO8qJI3-Q89biIpsnIBzM", authDomain: "polski-youtub2.firebaseapp.com", projectId: "polski-youtub2", storageBucket: "polski-youtub2.firebasestorage.app", messagingSenderId: "325129789226", appId: "1:325129789226:web:f68f2f1a1f8f9feaf14853", measurementId: "G-B5M3F5J713" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const vid = new URLSearchParams(location.search).get('id');

    async function load() {
        const vRef = doc(db, "content", vid);
        await updateDoc(vRef, { views: increment(1) });
        const vSnap = await getDoc(vRef);
        const data = vSnap.data();
        
        document.getElementById('vPlayer').src = data.url;
        document.getElementById('vTitle').innerText = data.title;
        document.getElementById('vStats').innerText = `${data.views || 0} wy≈õwietle≈Ñ ‚Ä¢ ${data.shares || 0} udostƒôpnie≈Ñ`;
        document.getElementById('likeCount').innerText = data.likes || 0;

        const uSnap = await getDoc(doc(db, "users", data.author));
        const suby = uSnap.exists() ? uSnap.data().subs || 0 : 0;
        document.getElementById('vAuthor').innerHTML = `<b>${data.author}</b> ${uSnap.exists() && uSnap.data().verified ? '‚úîÔ∏è' : ''}<br><small>${suby} subskrypcji</small>`;
    }

    document.getElementById('likeBtn').onclick = async () => {
        const user = auth.currentUser; if(!user) return alert("Zaloguj siƒô!");
        const vRef = doc(db, "content", vid); const vSnap = await getDoc(vRef);
        const likedBy = vSnap.data().likedBy || [];
        if(likedBy.includes(user.email)) await updateDoc(vRef, { likes: increment(-1), likedBy: arrayRemove(user.email) });
        else await updateDoc(vRef, { likes: increment(1), likedBy: arrayUnion(user.email) });
        location.reload();
    };

    document.getElementById('shareBtn').onclick = async () => {
        await updateDoc(doc(db, "content", vid), { shares: increment(1) });
        navigator.clipboard.writeText(window.location.href);
        alert("Link skopiowany!");
    };
    load();


import { doc, setDoc, arrayUnion, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Funkcja zapisujƒÖca historiƒô
async function addToHistory(videoData, videoId) {
    const user = auth.currentUser;
    if(user && videoData) {
        const historyItem = {
            id: videoId,
            title: videoData.title,
            url: videoData.url,
            watchedAt: new Date() // Tymczasowo JS Date, Firebase zamieni to przy zapisie
        };

        // U≈ºywamy setDoc z {merge: true}, ≈ºeby utworzyƒá dokument usera je≈õli nie istnieje
        await setDoc(doc(db, "users", user.email), {
            history: arrayUnion(historyItem)
        }, { merge: true });
        
        console.log("Dodano do historii");
    }
}


</script>
</body>
</html>
