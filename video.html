<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>OglƒÖdaj - Polski YouTube</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: sans-serif; margin: 0; }
        .player-container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        video { width: 100%; border-radius: 12px; background: black; }
        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn { background: #272727; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .btn:hover { background: #3f3f3f; }
        .verified-badge { color: #3ea6ff; margin-left: 5px; }
    </style>
</head>
<body>

<div class="player-container">
    <video id="mainVideo" controls autoplay></video>
    <h1 id="vTitle">≈Åadowanie...</h1>
    <p id="vAuthor"></p>
    <div class="actions">
        <button class="btn" id="likeBtn">üëç <span id="likeCount">0</span></button>
        <button class="btn" id="shareBtn">üöÄ UDOSTƒòPNIJ</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, arrayUnion, arrayRemove, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { /* TWOJE CONFIG */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const params = new URLSearchParams(location.search);
    const videoId = params.get('id');

    async function loadVideo() {
        const vSnap = await getDoc(doc(db, "content", videoId));
        const data = vSnap.data();
        
        document.getElementById('mainVideo').src = data.url;
        document.getElementById('vTitle').innerText = data.title;
        document.getElementById('likeCount').innerText = data.likes || 0;

        // Sprawdzanie weryfikacji autora
        const uSnap = await getDoc(doc(db, "users", data.author));
        document.getElementById('vAuthor').innerHTML = data.author + (uSnap.exists() && uSnap.data().verified ? ' <span class="verified-badge">‚úîÔ∏è</span>' : '');
    }

    // SYSTEM LAJK√ìW (Blokada wielu lajk√≥w)
    document.getElementById('likeBtn').onclick = async () => {
        const user = auth.currentUser;
        if (!user) return alert("Zaloguj siƒô!");

        const vRef = doc(db, "content", videoId);
        const vSnap = await getDoc(vRef);
        const data = vSnap.data();
        const likedBy = data.likedBy || [];

        if (likedBy.includes(user.email)) {
            await updateDoc(vRef, { likes: increment(-1), likedBy: arrayRemove(user.email) });
        } else {
            await updateDoc(vRef, { likes: increment(1), likedBy: arrayUnion(user.email) });
        }
        location.reload();
    };

    // UDOSTƒòPNIANIE
    document.getElementById('shareBtn').onclick = async () => {
        const url = window.location.href;
        if (navigator.share) {
            await navigator.share({ title: 'Polski YouTube', url: url });
        } else {
            await navigator.clipboard.writeText(url);
            alert("Link skopiowany!");
        }
    };

    loadVideo();
</script>
</body>
</html>
